<!DOCTYPE html>

<html
  lang="ko" xmlns:th="http://www.thymeleaf.org"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
>
<th:block th:replace="~{layout/mainlayout::all(~{this::#head} ,~{this::#content})}">

  <span id="head">
    <title>거래명세서 수정</title>
    <!--Style-->
    <style>
      #content2 {
        height: 300px;
        overflow-y: auto; /* 내부 스크롤 활성화 */
      }
    </style>
    <!--/Style-->
  </span>

  <span id="content">
    <div class="container-xxl flex-grow-1 container-p-y">
      <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">거래명세서 /</span> 거래명세서 수정</h4>
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <!-- Bordered Table -->
            <div class="card">
              <div class="card-body mb-4" style="height: 10px;">
                <div class="row">
                  <div class="col-md-4">
                    <button
                            type="button"
                            class="btn btn-outline-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#modalScrollable2"
                    >
                      자재선택
                    </button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <input type="number" style="display:none;" id="pno" th:value="${partner.pno}">
                <input type="number" style="display:none;" id="shipNumber">
                <input type="number" style="display:none;" id="tranNumber" th:value="${invoice.tranNO}">
                <div class="table-responsive text-nowrap">
                  <table class="table table-bordered">
                    <tr>
                      <th rowspan="6" style="writing-mode: vertical-lr;text-align: center; width: 5%;
                               border-top: 2px solid red; border-bottom: 2px solid red;">
                        공급자
                      </th>
                      <th style="text-align: center; border-top: 2px solid red; width: 5%;">
                        등록<br />번호
                      </th>
                      <td colspan="5" style="border-top: 2px solid red; width: 260px;" id="partnerRegister">[[${partner.registrationNumber}]]
                      </td>
                      <th style="text-align: center; border-top: 2px solid red;">
                        종사업장<br />번호
                      </th>
                      <td colspan="5" style="border-top: 2px solid red;">
                        <input type="text" style="border: 0; width: 100%; min-width: 100px">
                      </td>
                      <th rowspan="6"
                          style="writing-mode: vertical-lr; text-align: center; width: 5%;
                               border-top: 2px solid blue; border-bottom: 2px solid blue; border-left: 3px solid gray;">
                        공급받는자
                      </th>
                      <th style="text-align: center; border-top: 2px solid blue; width: 5%;">
                        등록<br />번호
                      </th>
                      <td colspan="5" style="border-top: 2px solid blue; width: 260px;">[[${company.registrationNumber}]]</td>
                      <th style="text-align: center; border-top: 2px solid blue;">
                        종사업자<br />번호
                      </th>
                      <td colspan="5" style="border-top: 2px solid blue;">
                        <input type="text" style="border: 0; width: 100%; min-width: 100px;">
                      </td>
                    </tr>
                    <tr>
                      <th style="text-align: center;">상호</th>
                      <td colspan="5" id="partnerName">[[${partner.name}]]</td>
                      <th style="text-align: center;">성명</th>
                      <td colspan="5" id="partnerCEO">[[${partner.ceo}]]</td>
                      <th style="text-align: center;">상호</th>
                      <td colspan="5">[[${company.name}]]</td>
                      <th style="text-align: center;">성명</th>
                      <td colspan="5">[[${company.ceo}]]</td>
                    </tr>
                    <tr>
                      <th style="text-align: center;">사업장</th>
                      <td colspan="11" id="partnerLocation">[[${partner.location}]]</td>
                      <th style="text-align: center;">사업장</th>
                      <td colspan="11">[[${company.location}]]</td>
                    </tr>
                    <tr>
                      <th style="text-align: center;">업태</th>
                      <td colspan="5" id="partnerType">[[${partner.type}]]</td>
                      <th style="text-align: center;">종목</th>
                      <td colspan="5" id="partnerSector">[[${partner.sector}]]</td>
                      <th style="text-align: center;">업태</th>
                      <td colspan="5">[[${company.type}]]</td>
                      <th style="text-align: center;">종목</th>
                      <td colspan="5">[[${company.sector}]]</td>
                    </tr>
                    <tr>
                      <th style="text-align: center;">이메일</th>
                      <td colspan="11">
                        <input type="text" style="border: 0; width: 100%; min-width: 100px" id="partnerEmail" th:value="${invoice.email1}">
                      </td>
                      <th rowspan="2" style="text-align: center; border-bottom: 2px solid blue;">
                        이메일
                      </th>
                      <td rowspan="2" colspan="11" style=" border-bottom: 2px solid blue;">[[${company.email}]]</td>
                    </tr>
                    <tr>
                      <th style="text-align: center; border-bottom: 2px solid red;">이메일</th>
                      <td colspan="11" style="border-bottom: 2px solid red;">
                        <input type="text" style="border: 0; width: 100%; min-width: 100px" id="partnerEmail2" th:value="${invoice.email2}">
                      </td>
                    </tr>
                    <tr>
                      <td colspan="22"></td>
                    </tr>
                    <tr>
                      <th colspan="2" style="text-align: center;">작성일자</th>
                      <td colspan="11"> <input type="date" id="writeDate" th:value="${date}"> </td>
                      <th colspan="2" style="text-align: center;">비고</th>
                      <td colspan="11"> <input type="text" style="border: 0; width: 400px;" id="text" th:value="${invoice.text}"> </td>
                    </tr>
                    <tr>
                      <th colspan="2" style="text-align: center;">합계금액</th>
                      <td colspan="6" id="totalSum"></td>
                      <th style="text-align: center;">공급가액</th>
                      <td colspan="6" id="totalSupply"></td>
                      <th style="text-align: center;">세액</th>
                      <td colspan="6" id="totalTax"></td>
                    </tr>
                    <tr>
                      <td colspan="22"></td>
                    </tr>
                    <tr>
                      <th style="text-align: center;">월</th>
                      <th style="text-align: center;">일</th>
                      <th colspan="6" style="text-align: center;">품목</th>
                      <th colspan="2" style="text-align: center;">규격</th>
                      <th style="text-align: center;">수량</th>
                      <th colspan="4" style="text-align: center;">단가</th>
                      <th colspan="3" style="text-align: center;">공급가액</th>
                      <th colspan="3" style="text-align: center;">세액</th>
                      <th colspan="2" style="text-align: center;">비고</th>
                    </tr>
                    <tbody id="insertPoint"></tbody>
                    <tr>
                      <td colspan="22"></td>
                    </tr>
                    <tr>
                      <th colspan="5" style="text-align: center;">현금</th>
                      <th colspan="5" style="text-align: center;">수표</th>
                      <th colspan="5" style="text-align: center;">어음</th>
                      <th colspan="5" style="text-align: center;">외상미수금</th>
                      <th rowspan="2" colspan="2">
                        <div class="text-center">
                          <input type="radio" name="type" value="영수" class="mb-2" th:checked="${invoice.plz == '영수'}">영수<br/>
                          <input type="radio" name="type" value="청구" th:checked="${invoice.plz == '청구'}">청구
                        </div>
                      </th>
                    </tr>
                    <tr>
                      <td colspan="5"> <input type="text" style="border: 0; width: 100%;" name="cash" id="cash" th:value="${invoice.cash}"> </td>
                      <td colspan="5"> <input type="text" style="border: 0; width: 100%;" name="cheque" id="cheque" th:value="${invoice.cheque}"> </td>
                      <td colspan="5"> <input type="text" style="border: 0; width: 100%;" name="promissory" id="promissory" th:value="${invoice.promissory}"> </td>
                      <td colspan="5"> <input type="text" style="border: 0; width: 100%;" name="receivable" id="receivable" th:value="${invoice.receivable}"> </td>
                    </tr>
                  </table>
                  <br>
                  <!--뒤로가기,등록 버튼 세트-->
                  <div class="d-flex justify-content-between w-100">
                    <a th:href="@{/invoice/list_invoice}">
                      <button type="button" class="btn btn-outline-secondary">취소</button>
                    </a>
                    <input type="number" style="display:none;" name="pno" id="partnerPno" th:attr="value=${selectedPartner != null ? selectedPartner : ''}">
                    <input type="number" style="display:none;" id="selectedShipNo" th:attr="value=${selectedShipNo != null ? selectedShipNo : ''}">
                    <button type="button" class="btn btn-primary btn-sm" onclick="saveInvoice()">수정하기</button>
                  </div>
                  <!--/-->
                </div>
              </div>
            </div>
            <!--/ Bordered Table -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalScrollable2" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content" style="width: 600px;">
          <div class="modal-body">
            <h5 class="modal-title mb-4">자재 검색</h5>
            <div class="row mb-10 mb-2">
              <label class="form-label col-md-2" style="width: fit-content;">자재</label>
              <div class="col-md-10">
                <div class="row mb-2">
                  <div class="col-md-4">
                    <select class="form-select form-select-sm" id="selectMaterL2" onchange="updateMaterCode2('L')"></select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select form-select-sm" id="selectMaterM2" onchange="updateMaterCode2('M')"></select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select form-select-sm" id="selectMaterS2" onchange="updateMaterCode2('S')"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-8">
                    <input type="text" class="form-control" id="materialSearch2" style="height: 32px; font-size: 12px;" value="">
                  </div>
                  <div class="col-md-4">
                    <button type="button" class="col-md-3 btn btn-sm btn-outline-primary" style="width: 70px;" onclick="materialSearchBtn2('invoice')">검색</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="m-0">
          <div class="modal-body" style="height: 350px;">
            <input type="number" value="0" style="display:none;" id="checkValue">
            <div class="table-responsive text-nowrap">
              <div id="content2">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>
                        <button type="button" class="btn btn-primary btn-sm" onclick="selectAllNonContractJodalPlan()">모두선택</button>
                      </th>
                      <th>자재번호</th>
                      <th>자재명</th>
                      <th>입고일</th>
                      <th>수량</th>
                    </tr>
                  </thead>
                  <tbody id="secondTbody"></tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addInvoiceShipment()">
              추가
            </button>
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              닫기
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--/Modal-->

    <!--Script-->
    <script src="../assets/js/new-contract-order-invoice.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        content2.addEventListener("scroll", function () {
            if(finPage2==false){
                const scrollTop = content2.scrollTop;
                const scrollHeight = content2.scrollHeight;
                const clientHeight = content2.clientHeight;

                if (scrollTop + clientHeight >= scrollHeight - 10) {
                    loadItems2('invoice');
                }
            }
        });

        initModifyInvoice();
        setTimeout(function() {
          loadItems2('invoice');
        }, 1000);
      });
    </script>
    <!--Script-->
  </span>

</th:block>
</html>